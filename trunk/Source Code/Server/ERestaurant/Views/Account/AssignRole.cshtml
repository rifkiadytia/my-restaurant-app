@model ERestaurant.Models.RoleModel

@{
    ViewBag.Title = "AssignRole";
}

<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<!--basic styles-->

<link href="@Url.Content("~/Content/css/bootstrap.min.css")" rel="stylesheet" />
<link href="@Url.Content("~/Content/css/bootstrap-responsive.min.css")" rel="stylesheet" />
<link rel="stylesheet" href="@Url.Content("~/Content/css/font-awesome.min.css")" />

<!--[if IE 7]>
		  <link rel="stylesheet" href="@Url.Content("~/Content/css/font-awesome-ie7.min.css")" />
		<![endif]-->

<!--page specific plugin styles-->

<!--fonts-->

<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300" />

<!--ace styles-->

<link rel="stylesheet" href="@Url.Content("~/Content/css/ace.min.css")" />
<link rel="stylesheet" href="@Url.Content("~/Content/css/ace-responsive.min.css")" />
<link rel="stylesheet" href="@Url.Content("~/Content/css/ace-skins.min.css")" />

<!--[if lte IE 8]>
		  <link rel="stylesheet" href="@Url.Content("~/Content/css/ace-ie.min.css")" />
		<![endif]-->

<!--basic scripts-->

<!--[if !IE]>-->

<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<!--<![endif]-->

<!--[if IE]>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<![endif]-->

<!--[if !IE]>-->

<script type="text/javascript">
    window.jQuery || document.write("<script src='@Url.Content("~/Scripts/js/jquery-2.0.3.min.js")'>" + "<" + "/script>");
</script>

<!--<![endif]-->

<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='@Url.Content("~/Scripts/js/jquery-1.10.2.min.js")'>"+"<"+"/script>");
</script>
<![endif]-->

<script type="text/javascript">
    if ("ontouchend" in document) document.write("<script src='@Url.Content("~/Scripts//js/jquery.mobile.custom.min.js")'>" + "<" + "/script>");
</script>
<script src="@Url.Content("~/Scripts/js/bootstrap.min.js")"></script>

<!--page specific plugin scripts-->

<script src="@Url.Content("~/Scripts/js/jquery.dataTables.min.js")"></script>
<script src="@Url.Content("~/Scripts/js/jquery.dataTables.bootstrap.js")"></script>

<!--ace scripts-->

<script src="@Url.Content("~/Scripts/js/ace-elements.min.js")"></script>
<script src="@Url.Content("~/Scripts/js/ace.min.js")"></script>
@using (Html.BeginForm("AssignRole", "Account", FormMethod.Post, new { id = "assignRoleForm" }))
{
    @Html.HiddenFor(model => model.UserId)
 
     
    <div id="user-profile-1" class="user-profile row-fluid">
        <div class="span3 center">
            <div>
                <span class="profile-picture">
                    <img id="avatar" class="editable editable-click editable-empty" src="@Url.Content("~/Upload/images/" + Model.UserInfo.Image)"></img>
                </span>

                <div class="space-4"></div>
            </div>

            <div class="space-6"></div>

            <div class="hr hr12 dotted"></div>
        </div>

        <div class="span9">


            <div class="space-12"></div>

            <div class="profile-user-info profile-user-info-striped">
                <div class="profile-info-row">
                    <div class="profile-info-name">Username </div>

                    <div class="profile-info-value">
                        <span  id="username">@Model.UserInfo.UserName</span>
                    </div>
                </div>

                <div class="profile-info-row">
                    <div class="profile-info-name">Address </div>

                    <div class="profile-info-value">
                        
                        <span id="country">@Model.UserInfo.Address</span>
                    </div>
                </div>

                <div class="profile-info-row">
                    <div class="profile-info-name">Birthdate </div>
                    
                    <div class="profile-info-value">
                        <span id="age">@Model.UserInfo.DOB.Value.ToString("dd/MM/yyyy")</span>
                    </div>
                </div>

                <div class="profile-info-row">
                    <div class="profile-info-name">Gender </div>

                    <div class="profile-info-value">
                        <span  id="signup">@{
    String gender = Model.UserInfo.Gender == true ? "Male" : "Famale";
                        }@gender</span>
                    </div>
                </div>


            </div>

            <div class="space-20"></div>
            <div class="hr hr2 hr-double"></div>

            <div class="space-6"></div>


        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <table id="tblRole" class="table table-striped table-bordered table-hover">
                <thead>
                    <tr>
                        <th class="center">
                            <label>
                                <input type="checkbox">
                                <span class="lbl"></span>
                            </label>
                        </th>
                        <th>Role Name</th>
                        <th>Role Description</th>

                    </tr>
                </thead>

                <tbody>
                    @for (int i = 0; i < Model.Roles.Count; i++)
                    {
                        <tr>
                            <td class="center">
                                <label>
                                    <input type="checkbox">
                                    <span class="lbl"></span>
                                    @Html.HiddenFor(m=>m.Roles[i].IsSelected)
                                </label>
                            </td>

                            <td>
                                @Html.HiddenFor(m => m.Roles[i].RoleID)
                                @Html.Label(Model.Roles[i].RoleName)
                            </td>
                            <td>@Html.Label(Model.Roles[i].RoleDescription)</td>

                        </tr>
                    }



                </tbody>
            </table>
        </div>
        <!--/span-->
    </div>@*
    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="submit" value="Assign" class="btn btn-primary no-border" />
        </div>
    </div>*@
    <div class="form-actions">
				<button class="btn btn-info" type="button">
													<i class="icon-ok bigger-110"></i>
													Assign
												</button>								
       @* <input type="submit" value="Assign" class="btn btn-primary no-border" />*@

	</div>
}
<script type="text/javascript">
    $(function () {
        //Get json data 
        $('#tblRole > tbody  > tr').each(function () {
            var isSelected = $(this).find('td:first-child input:hidden').val();
            if (isSelected) {
                var checkedColumn = $(this).find('td:first-child input:checkbox');
                $(checkedColumn).prop('checked', true);
                $(this).closest('tr').toggleClass('selected');
            }
        });

        $('table th input:checkbox').on('click', function () {
            var that = this;
            $(this).closest('table').find('tr > td:first-child input:checkbox')
            .each(function () {
                this.checked = that.checked;
                $(this).closest('tr').toggleClass('selected');
            });

        });
        $('.btn-info').on('click', function () {
            var selectedRoleArr = [];
            var userId = $('#UserId').val();
            $('#tblRole > tbody  > tr').each(function () {
                var checkedColumn = $(this).find('td:first-child input:checkbox');
                if (checkedColumn.prop('checked')) {
                    //find role name , role id
                    var roleId = $(this).find('td:nth-child(2) input:hidden').val();
                    //var roleName = $(this).find('td:nth-child(2) label').text();
                    var roleItem = { RoleID: roleId };
                    selectedRoleArr.push(roleItem);
                }
            });
            var token = Math.random();
            $.ajax({
                type: 'POST',
                url: '@Url.Action("AssignRole","Account")',
                data: JSON.stringify({ model: selectedRoleArr, UserId: userId ,token : token}),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (msg) {
                    if (msg.StatusCode === "SC.001") {
                        alert("Role assign successfuly !");
                        window.location = "/account/searchuser";
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    alert('Status error code : ' + xhr.status);

                },
                async: true,
                processData: false
            });
            return false;
        });

        $('[data-rel="tooltip"]').tooltip({ placement: tooltip_placement });
        function tooltip_placement(context, source) {
            var $source = $(source);
            var $parent = $source.closest('table')
            var off1 = $parent.offset();
            var w1 = $parent.width();

            var off2 = $source.offset();
            var w2 = $source.width();

            if (parseInt(off2.left) < parseInt(off1.left) + parseInt(w1 / 2)) return 'right';
            return 'left';
        }
    })
</script>


